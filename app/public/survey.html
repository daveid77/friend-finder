<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex,nofollow">
  <link rel="icon" type="image/png" href="favicon.ico"/>
  <title>Friend Finder :: David Morse</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <style>
    /*input[type="text"]:invalid {
      background-color: pink;
    }*/
  </style>

</head>
<body>

  <!-- MODAL OVERLAY -->
  <div id="friend-finder-match" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Your Best Match</h4>
        </div>
        <div class="modal-body">
          <h3 style="margin-top: 0;"><span id="match-name"></span></h3>
          <div style="width: 500px; height: 400px; overflow: hidden;">
            <img id="match-photo" src="" style="width: 500px; height: auto;">
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- MAIN PAGE CONTENT AND FORM -->
  <div class="container">
    <div class="row">
      <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">

        <!-- <a href="#" data-toggle="modal" data-target="#friend-finder-match">Modal Link</a> -->

        <div class="jumbotron">
          <h2 style="margin-top: 0;">Friend Finder Survey</h2>
          
          <p>Help Us Find Your Best Match</p>

          <hr noshade style="border-color: #999;">

          <p style="font-size: .95em; font-style: italic; color: #ff0000;">[All fields are required]</p>
          <form role="form" id="new-user-form">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" class="form-control" id="user-name" placeholder="Enter name" value="" required>
            </div>
            <div class="form-group">
              <label for="photo-link">Link to Photo</label>
              <input type="url" class="form-control" id="user-photo-link" placeholder="Enter photo URL" value="https://pbs.twimg.com/profile_images/846504681291460609/5f-LaW8I_400x400.jpg" required>
            </div>

            <hr noshade style="border-color: #999;">

            <div class="form-group">
              <h4>Question 1:</h4>
              <label for="question1">You are more of a thinker than a doer.</label>
              <select id="question1" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 2:</h4>
              <label for="question2">It's more important to be funny than right.</label>
              <select id="question2" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 3:</h4>
              <label for="question3">Giving is better than receiving.</label>
              <select id="question3" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 4:</h4>
              <label for="question4">Time alone is a good thing.</label>
              <select id="question4" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 5:</h4>
              <label for="question5">Cleanliness is next to godliness.</label>
              <select id="question5" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 6:</h4>
              <label for="question6">We can be most cruel when we feel bad about ourselves.</label>
              <select id="question6" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 7:</h4>
              <label for="question7">Movie stars are the most important people.</label>
              <select id="question7" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 8:</h4>
              <label for="question8">You have to get along to go along.</label>
              <select id="question8" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 9:</h4>
              <label for="question9">Anger is a gift.</label>
              <select id="question9" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <div class="form-group">
              <h4>Question 10:</h4>
              <label for="question10">Non-human animals are better to befriend than eat.</label>
              <select id="question10" class="form-control" required>
                <option value="">Choose One</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>

            <hr noshade style="border-color: #999;">

            <button type="submit" class="btn btn-primary submit">
              <span class="glyphicon glyphicon-ok-circle"></span>
              Submit
            </button>
          </form>

        </div>
      </div>
    </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
          <p>
            <a href="/">Home</a> | 
            <a href="/api/friends">API Friends List</a> | 
            <a href="https://github.com/dbmarshall/friend-finder">GitHub Repo</a>
          </p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <script type="text/javascript">

    $('.submit').on('click', function(event) {

      //  Force valid data for each form element via HTML5
      var validation = [];
      $('#new-user-form input, #new-user-form select').each(function() {
        console.log(this);
        if (!this.checkValidity()) {
          validation.push(this);
          return false;
        } 
      });

      // When all form elements validate move on...
      if (validation.length <= 0) {
      
        // Placing event.preventDefault() before validation confirmation
        // would have prevented HTML5 validation from working
        event.preventDefault();

        var userScores = [];
        $('select').each(function() {
          userScores.push(parseInt($(this).val()));
        });

        var newUser = {
          name: $("#user-name").val().trim(),
          photoLink: $("#user-photo-link").val().trim(),
          scores: userScores
        };

        $.post("/api/friends", newUser, function(bestMatchData) {

          // Populate modal and display  
          $('#match-name').text(bestMatchData.name);
          $('#match-photo').attr('src', bestMatchData.photoLink);
          $('#friend-finder-match').modal('show');

          // Clear previous form information
          $('#name').val('');
          $('#photo-link').val('');
          $('select').prop('selectedIndex','');

        });

      }

    });

  </script>

</body>
</html>